// --- NOUVELLE LOGIQUE : DÉTECTION DE VOLUME & MOMENTUM RÉEL ---

function detectWhaleMovement() {
    if (priceHistory.length < 20) return "SYNC";

    const lastPrice = priceHistory[priceHistory.length - 1];
    const oldPrice = priceHistory[priceHistory.length - 10]; // Comparaison sur 10 secondes
    
    // Calcul de la vitesse du prix (Velocity)
    const velocity = (lastPrice - oldPrice);
    const volatility = Math.abs(velocity);

    // SEUIL DE FIABILITÉ : On cherche un mouvement brusque et puissant
    // Sur le BTC, un mouvement de plus de 5$ en 10s indique une injection de volume
    const threshold = 5.0; 

    if (volatility > threshold) {
        if (velocity > 0) return "CALL"; // Injection massive d'achats
        if (velocity < 0) return "PUT";  // Injection massive de ventes
    }
    
    return "WAIT"; // Si le mouvement est faible, on ne fait rien
}

// --- DANS TA FONCTION startHFTScan ---
// Utilise cette nouvelle détection :

const decision = detectWhaleMovement();

if (decision === "WAIT" || decision === "SYNC") {
    sig.innerText = "WAIT";
    sig.style.color = "var(--gold)";
    logs.innerHTML = `> <span style="color:#555">[FILTRE]</span> Volume insuffisant. Signal rejeté.<br>` + logs.innerHTML;
} else {
    sig.innerText = decision;
    sig.style.color = decision === "CALL" ? "var(--win)" : "var(--loss)";
    logs.innerHTML = `> <span style="color:var(--gold)">[WHALE DETECTED]</span> Forte impulsion ${decision} !<br>` + logs.innerHTML;
}
