<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aegis Signal Bot PRO</title>

<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
body{
background:#0a0a0f;
color:#e8e8f0;
font-family:Arial;
padding:18px;
}

.card{
background:#12121a;
border:1px solid #2a2a3a;
border-radius:14px;
padding:16px;
margin-bottom:16px;
}

#chart{height:360px}

.grid{
display:grid;
grid-template-columns:1fr 1fr 1fr;
gap:10px;
}

.stat{
background:#1a1a26;
padding:10px;
border-radius:8px;
}

.controls{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-top:12px;
}

button{
padding:12px 16px;
border:none;
border-radius:10px;
font-weight:700;
cursor:pointer;
font-size:14px;
}

.analyze{background:#00d4ff;color:#000}
.win{background:#00ff9d}
.loss{background:#ff0062;color:white}

.log{
font-size:12px;
color:#6b6b80;
max-height:180px;
overflow:auto;
}

.signalbox{
font-size:16px;
font-weight:700;
margin-bottom:8px;
}
</style>
</head>

<body>

<div class="card">
<h2>üìä Aegis Signal Bot PRO ‚Äî EUR/USD</h2>
<div id="chart"></div>
</div>

<div class="card">
<div class="grid">
<div class="stat">Balance: <b id="bal">50</b>$</div>
<div class="stat">Mise: <b id="bet">1</b>$</div>
<div class="stat">WinRate: <b id="wr">0%</b></div>
</div>

<div class="controls">
<button class="analyze" onclick="analyze()">üîç ANALYSER</button>
<button class="win" onclick="tradeResult(true)">‚úì GAGN√â</button>
<button class="loss" onclick="tradeResult(false)">‚úó PERDU</button>
</div>
</div>

<div class="card">
<div class="signalbox" id="signal">Signal: --</div>
<div class="log" id="log"></div>
</div>

<script>
const API="397ca9a6d7c24c37a84043c1b0219042";

let S={
bal:50,
bet:1,
wins:0,
loss:0,
data:[]
};

const chart = LightweightCharts.createChart(
document.getElementById("chart"),
{
layout:{background:{color:"#0a0a0f"},textColor:"#6b6b80"},
grid:{vertLines:{color:"#1a1a26"},horzLines:{color:"#1a1a26"}}
}
);

const series = chart.addCandlestickSeries();

function log(t){
let d=document.getElementById("log");
d.innerHTML+="<div>"+new Date().toLocaleTimeString()+" ‚Äî "+t+"</div>";
d.scrollTop=d.scrollHeight;
}

async function loadData(){
try{
let r=await fetch(`https://api.twelvedata.com/time_series?symbol=EUR/USD&interval=1min&outputsize=150&apikey=${API}`);
let j=await r.json();

if(!j.values){
log("API limite atteinte ou erreur");
return;
}

S.data=j.values.reverse().map(c=>({
time:new Date(c.datetime).getTime()/1000,
open:+c.open,
high:+c.high,
low:+c.low,
close:+c.close
}));

series.setData(S.data);
log("Donn√©es march√© charg√©es ("+S.data.length+")");

}catch(e){
log("Erreur connexion API");
}
}

setInterval(loadData,60000);
loadData();

function ema(p){
let k=2/(p+1);
let e=S.data[0].close;
for(let i=1;i<S.data.length;i++){
e=S.data[i].close*k+e*(1-k);
}
return e;
}

function rsi(p=14){
let g=0,l=0;
for(let i=S.data.length-p;i<S.data.length;i++){
let d=S.data[i].close-S.data[i-1].close;
if(d>=0) g+=d; else l-=d;
}
let rs=g/(l||1);
return 100-(100/(1+rs));
}

function momentum(){
let last=S.data.slice(-5);
return last[last.length-1].close - last[0].close;
}

function analyze(){
try{

if(!S.data || S.data.length<60){
log("Pas assez de bougies ‚Äî attends le chargement");
return;
}

let e20=ema(20);
let e50=ema(50);
let r=rsi();
let m=momentum();

let score=0;

if(e20>e50) score+=30; else score-=30;
if(r>55) score+=25;
if(r<45) score-=25;
if(m>0) score+=15; else score-=15;

let sig="WAIT";
if(score>=40) sig="CALL";
if(score<=-40) sig="PUT";

document.getElementById("signal").innerHTML=
"Signal: <b>"+sig+"</b> | Score "+score+" | RSI "+r.toFixed(1);

log("Analyse ex√©cut√©e ‚Üí "+sig+" | score "+score);

}catch(e){
log("Erreur analyse JS");
}
}

function tradeResult(win){

if(win){
S.bal+=S.bet;
S.bet=1;
S.wins++;
}else{
S.bal-=S.bet;
S.bet*=2;
S.loss++;
}

document.getElementById("bal").innerText=S.bal.toFixed(2);
document.getElementById("bet").innerText=S.bet.toFixed(2);

let wr=S.wins+S.loss;
wr = wr ? (S.wins/wr*100).toFixed(1):0;
document.getElementById("wr").innerText=wr+"%";

log(win?"Trade gagnant enregistr√©":"Trade perdant enregistr√©");
}

window.addEventListener("resize",()=>{
chart.applyOptions({width:document.getElementById("chart").offsetWidth});
});
</script>

</body>
</html>
