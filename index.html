<script>
    let balance = 10.00;
    const apiKey = '9d0cbeba8e3343c59c7292d1d296a790';
    let currentEurUsd = "1.08540"; // Valeur par défaut avant chargement

    // 1. Fonction pour récupérer le vrai prix EUR/USD
    async function fetchForexPrice() {
        try {
            const response = await fetch(`https://api.twelvedata.com/price?symbol=EUR/USD&apikey=${apiKey}`);
            const data = await response.json();
            if (data.price) {
                currentEurUsd = parseFloat(data.price).toFixed(5);
            }
        } catch (e) {
            console.error("Erreur de flux Twelve Data");
        }
    }

    // Mise à jour du prix toutes les 15 secondes (pour respecter les limites gratuites)
    setInterval(fetchForexPrice, 15000);
    fetchForexPrice(); // Premier appel au chargement

    function startHFTScan() {
        const btn = document.getElementById('hft-btn');
        const scan = document.getElementById('hft-scan');
        const res = document.getElementById('hft-result');
        const idle = document.getElementById('hft-idle');
        const sig = document.getElementById('sig-val');
        const box = document.getElementById('box');
        const logs = document.getElementById('logs');
        const expText = document.getElementById('exp-timer');

        btn.disabled = true;
        idle.style.display = 'none';
        res.style.display = 'none';
        scan.style.display = 'block';
        box.style.animation = "none";

        // Animation de la latence MS
        let ms = 0;
        const msInt = setInterval(() => {
            ms += Math.random() * 12;
            document.getElementById('ms-counter').innerText = ms.toFixed(2) + " ms";
            document.getElementById('v-val').innerText = (ms/15).toFixed(1) + " MS";
        }, 40);

        setTimeout(() => {
            clearInterval(msInt);
            
            // Simulation de décision IA
            const direction = Math.random() > 0.5 ? "CALL" : "PUT";
            scan.style.display = 'none';
            res.style.display = 'block';
            sig.innerText = direction;
            
            const color = direction === "CALL" ? "var(--win)" : "var(--loss)";
            sig.style.color = color;
            box.style.borderColor = color;
            box.style.animation = direction === "CALL" ? "pulse-win 2s infinite" : "pulse-loss 2s infinite";

            // Compte à rebours 60s
            let timeLeft = 60;
            expText.innerText = timeLeft + "s";
            const expInt = setInterval(() => {
                timeLeft--;
                expText.innerText = timeLeft + "s";
                if(timeLeft <= 0) clearInterval(expInt);
            }, 1000);

            // Mise à jour Solde et Barre de progression (Objectif 1000$)
            const profit = (Math.random() * 2.5 + 0.5).toFixed(2);
            balance += parseFloat(profit);
            document.getElementById('balance').innerText = balance.toFixed(2) + "$";
            
            // Calcul du % par rapport à 1000$
            let progress = (balance / 1000) * 100;
            document.getElementById('progress-fill').style.width = progress + "%";

            // LOG avec le vrai prix EUR/USD de l'API
            logs.innerHTML = `> <span style="color:var(--gold)">[EUR/USD @${currentEurUsd}]</span> ${direction} +${profit}$<br>` + logs.innerHTML;

            // Cooldown bouton
            let cd = 5;
            const cooldownInt = setInterval(() => {
                btn.innerText = `RE-SCAN (${cd}s)`;
                cd--;
                if(cd < 0) {
                    clearInterval(cooldownInt);
                    btn.disabled = false;
                    btn.innerText = "SNIPE MOMENTUM";
                }
            }, 1000);

        }, 3000);
    }
            </script>
