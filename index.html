<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Robot Trading Live</title>

<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
:root{
--bg:#0a0a0f; --card:#12121a; --border:#2a2a3a;
--primary:#00d4ff; --success:#00ff9d; --danger:#ff0062;
--text:#e8e8f0; --dim:#6b6b80;
}

body{background:var(--bg);color:var(--text);font-family:Arial;padding:20px}
.container{max-width:1200px;margin:auto}

.card{background:var(--card);border:1px solid var(--border);
border-radius:14px;padding:20px;margin-bottom:20px}

h1{margin-bottom:10px}

#chart{height:380px}

.controls{display:flex;gap:12px;margin-top:15px;flex-wrap:wrap}

button{
padding:12px 18px;
border:none;
border-radius:10px;
font-weight:700;
cursor:pointer;
font-size:14px;
}

.analyze{background:var(--primary);color:#000}
.win{background:var(--success)}
.loss{background:var(--danger);color:#fff}

.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.stat{background:#1a1a26;padding:12px;border-radius:10px}

.log{font-size:12px;color:var(--dim);max-height:160px;overflow:auto}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h1>üìä Robot EUR/USD ‚Äî Live TwelveData</h1>
<div id="chart"></div>
</div>

<div class="card">
<div class="stats">
<div class="stat">Balance: <b id="bal">50</b>$</div>
<div class="stat">Mise: <b id="bet">1</b>$</div>
<div class="stat">WinRate: <b id="wr">0%</b></div>
</div>

<div class="controls">
<button class="analyze" onclick="analyze()">üîç ANALYSER</button>
<button class="win" onclick="result(true)">‚úì GAGN√â</button>
<button class="loss" onclick="result(false)">‚úó PERDU</button>
</div>
</div>

<div class="card">
<div id="signal">Signal: --</div>
<div class="log" id="log"></div>
</div>

</div>

<script>
const API="397ca9a6d7c24c37a84043c1b0219042";

let state={
balance:50,
bet:1,
wins:0,
losses:0,
data:[]
};

const chart = LightweightCharts.createChart(document.getElementById('chart'),{
layout:{background:{color:"#0a0a0f"},textColor:"#6b6b80"},
grid:{vertLines:{color:"#1a1a26"},horzLines:{color:"#1a1a26"}}
});

const series = chart.addCandlestickSeries();

function log(t){
const el=document.getElementById("log");
el.innerHTML+="<div>"+new Date().toLocaleTimeString()+" ‚Äî "+t+"</div>";
el.scrollTop=el.scrollHeight;
}

async function load(){
const r=await fetch(`https://api.twelvedata.com/time_series?symbol=EUR/USD&interval=1min&outputsize=120&apikey=${API}`);
const j=await r.json();
if(!j.values){log("Erreur API");return;}
state.data=j.values.reverse().map(c=>({
time:new Date(c.datetime).getTime()/1000,
open:+c.open, high:+c.high, low:+c.low, close:+c.close
}));
series.setData(state.data);
log("Donn√©es live charg√©es");
}
setInterval(load,60000);
load();

function ema(period){
let k=2/(period+1);
let ema=state.data[0].close;
for(let i=1;i<state.data.length;i++){
ema=state.data[i].close*k+ema*(1-k);
}
return ema;
}

function rsi(p=14){
let gains=0,loss=0;
for(let i=state.data.length-p;i<state.data.length;i++){
let d=state.data[i].close-state.data[i-1].close;
if(d>=0) gains+=d; else loss-=d;
}
let rs=gains/(loss||1);
return 100-(100/(1+rs));
}

function analyze(){
if(state.data.length<60){log("Pas assez de data");return;}

let e20=ema(20);
let e50=ema(50);
let r=rsi();

let sig="WAIT";

if(e20>e50 && r>55) sig="CALL";
if(e20<e50 && r<45) sig="PUT";

document.getElementById("signal").innerHTML=
"Signal: <b>"+sig+"</b> | RSI "+r.toFixed(1);

log("Analyse faite ‚Üí "+sig);
}

function result(win){
if(win){
state.balance+=state.bet;
state.wins++;
state.bet=1;
}else{
state.balance-=state.bet;
state.losses++;
state.bet*=2;
}

document.getElementById("bal").innerText=state.balance.toFixed(2);
document.getElementById("bet").innerText=state.bet.toFixed(2);

let wr = state.wins+state.losses;
wr = wr? (state.wins/wr*100).toFixed(1):0;
document.getElementById("wr").innerText=wr+"%";

log(win?"Trade gagnant":"Trade perdant");
}
</script>
</body>
</html>
