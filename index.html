<script>
/* ===============================
   AEGIS STRATEGY LAYER (PASSIVE)
   Version: DISCIPLINE CORE
   Auteur: Matthieu Edition
   =============================== */

const STRATEGY = {
    enabled: true,              // Master switch
    minLatencyMS: 120,           // Filtre qualité
    maxTradesPerSession: 5,      // Anti overtrading
    maxLossStreak: 2             // Discipline mentale
};

let tradeCount = 0;
let lossStreak = 0;

/* Hook stratégique */
function strategyApproval(direction, latency) {
    if (!STRATEGY.enabled) return true;

    if (latency < STRATEGY.minLatencyMS) {
        logStrategy("Signal rejeté : latency trop faible");
        return false;
    }

    if (tradeCount >= STRATEGY.maxTradesPerSession) {
        logStrategy("Session bloquée : overtrading détecté");
        return false;
    }

    if (lossStreak >= STRATEGY.maxLossStreak) {
        logStrategy("Protection mentale activée");
        return false;
    }

    return true;
}

/* Journal stratégique */
function logStrategy(msg) {
    const logs = document.getElementById('logs');
    logs.innerHTML = `> <span style="color:#ff0044">[STRATEGY]</span> ${msg}<br>` + logs.innerHTML;
}

/* Surcouche sans modifier startHFTScan */
const _originalStart = startHFTScan;
startHFTScan = function () {
    const latency = parseFloat(document.getElementById('v-val').innerText) || 0;

    const approved = strategyApproval("AUTO", latency);
    if (!approved) {
        document.getElementById('box').style.borderColor = "#444";
        document.getElementById('hft-idle').innerText = "NO TRADE – FILTER ACTIVE";
        document.getElementById('hft-idle').style.display = "block";
        return;
    }

    tradeCount++;
    _originalStart();
};

/* Simulation résultat pour discipline */
setInterval(() => {
    const last = Math.random() > 0.6 ? "WIN" : "LOSS";
    if (last === "LOSS") lossStreak++;
    else lossStreak = 0;
}, 8000);
            </script>
