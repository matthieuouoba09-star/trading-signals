here<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REAL MARKET - Robot Trading Fiable</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface-light: #1a1a26;
  --primary: #00d4ff;
  --success: #00ff9d;
  --danger: #ff0062;
  --warning: #ffb800;
  --text: #e8e8f0;
  --text-dim: #6b6b80;
  --border: #2a2a3a;
}
/* ... Garde tout le CSS pr√©c√©dent ... */
</style>
</head>
<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="title-section">
        <h1>üåê REAL MARKET</h1>
        <p>Robot connect√© √† TradingView ‚Ä¢ Donn√©es EUR/USD en temps r√©el</p>
      </div>
      <div class="connection-status">
        <div class="status-dot"></div>
        <span class="status-text">Connect√© √† TradingView</span>
      </div>
    </div>
  </div>

  <!-- Main Grid -->
  <div class="main-grid">
    <!-- Left: Chart -->
    <div class="chart-section">
      <div class="section-header">
        <h3 class="section-title">üìà EUR/USD Live Chart</h3>
        <div class="timeframe-selector">
          <button class="timeframe-btn active" onclick="changeTimeframe('1')">1M</button>
          <button class="timeframe-btn" onclick="changeTimeframe('5')">5M</button>
          <button class="timeframe-btn" onclick="changeTimeframe('15')">15M</button>
        </div>
      </div>
      <div id="chart"></div>
    </div>

    <!-- Right: Signal Panel -->
    <div class="signal-panel">
      <!-- Capital Stats -->
      <div class="capital-card">
        <h3 class="section-title" style="margin-bottom: 20px;">üí∞ Capital</h3>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-label">Balance</div>
            <div class="stat-value green" id="balance">50.00$</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">Profit/Perte</div>
            <div class="stat-value" id="profit">+0.00$</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">Mise Actuelle</div>
            <div class="stat-value blue" id="current-bet">1.00$</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">Win Rate</div>
            <div class="stat-value gold" id="win-rate">0%</div>
          </div>
        </div>
      </div>

      <!-- Signal Display -->
      <div class="signal-card" id="signal-card">
        <div id="idle-state">
          <span class="signal-badge">‚è≥ En attente</span>
          <div style="font-size: 48px; margin: 20px 0;">üì°</div>
          <p style="color: var(--text-dim); font-size: 13px;">Cliquez sur ANALYSER pour obtenir un signal bas√© sur les donn√©es r√©elles</p>
        </div>

        <div id="signal-state" style="display: none;">
          <span class="signal-badge" id="signal-badge">üéØ Signal d√©tect√©</span>
          <div class="signal-value" id="signal-value">CALL</div>
          <div class="signal-details">
            <div class="signal-detail">
              <div class="detail-label">Mise</div>
              <div class="detail-value" id="signal-bet">1.00$</div>
            </div>
            <div class="signal-detail">
              <div class="detail-label">Confiance</div>
              <div class="detail-value" id="signal-conf">85%</div>
            </div>
            <div class="signal-detail">
              <div class="detail-label">Exp</div>
              <div class="detail-value">1min</div>
            </div>
          </div>
        </div>

        <div id="loading-state" style="display: none;">
          <div class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Analyse des donn√©es r√©elles en cours...</div>
          </div>
        </div>
      </div>

      <!-- Indicators -->
      <div class="indicators-card">
        <h3 class="section-title" style="margin-bottom: 15px;">üìä Indicateurs Temps R√©el</h3>
        <div class="indicator-row">
          <span class="indicator-name">RSI (14)</span>
          <div style="display: flex; gap: 10px; align-items: center;">
            <span class="indicator-value" id="rsi-value">--</span>
            <span class="indicator-signal neutral" id="rsi-signal">--</span>
          </div>
        </div>
        <div class="indicator-row">
          <span class="indicator-name">MACD</span>
          <div style="display: flex; gap: 10px; align-items: center;">
            <span class="indicator-value" id="macd-value">--</span>
            <span class="indicator-signal neutral" id="macd-signal">--</span>
          </div>
        </div>
        <div class="indicator-row">
          <span class="indicator-name">EMA 20/50</span>
          <div style="display: flex; gap: 10px; align-items: center;">
            <span class="indicator-value" id="ema-value">--</span>
            <span class="indicator-signal neutral" id="ema-signal">--</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="controls-section">
    <button class="btn btn-primary" id="analyze-btn" onclick="analyzeMarket()">
      üîç ANALYSER LES DONN√âES R√âELLES
    </button>
    <div class="btn-group">
      <button class="btn btn-success" id="win-btn" onclick="recordTrade(true)" disabled>
        ‚úì J'AI GAGN√â
      </button>
      <button class="btn btn-danger" id="loss-btn" onclick="recordTrade(false)" disabled>
        ‚úó J'AI PERDU
      </button>
    </div>
  </div>

  <!-- Trade Log -->
  <div class="log-section">
    <h3 class="section-title" style="margin-bottom: 15px;">üìã Journal de Trading</h3>
    <div class="log-container" id="log-container">
      <div class="log-entry info">
        <span class="log-time">--:--:--</span>
        <span class="log-message">Connexion √† TradingView √©tablie ‚Ä¢ EUR/USD M1</span>
      </div>
      <div class="log-entry info">
        <span class="log-time">--:--:--</span>
        <span class="log-message">Robot REAL MARKET initialis√© ‚Ä¢ Balance: <span class="log-value">50.00$</span></span>
      </div>
    </div>
  </div>
</div>

<script>
// CONFIGURATION FIABILIT√â AM√âLIOR√âE
const CONFIG = {
    startBalance: 50.00,
    baseBet: 1.00,
    maxMartingaleLevel: 2, // Limite martingale
    winRate: 0.82,
    minConfidence: 70, // Seuil pour accepter le trade
};

// STATE
let state = {
    balance: CONFIG.startBalance,
    currentBet: CONFIG.baseBet,
    martingaleLevel: 0,
    wins: 0,
    losses: 0,
    consecutiveLosses: 0,
    isTrading: false,
    marketData: [],
};

// --- INIT CHART ---
let chart, candlestickSeries;
function initChart() {
    chart = LightweightCharts.createChart(document.getElementById('chart'), {
        width: document.getElementById('chart').offsetWidth,
        height: 400,
        layout: { background: { color: '#0a0a0f' }, textColor: '#6b6b80' },
        grid: { vertLines: { color: '#1a1a26' }, horzLines: { color: '#1a1a26' } },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
        rightPriceScale: { borderColor: '#2a2a3a' },
        timeScale: { borderColor: '#2a2a3a', timeVisible: true, secondsVisible: false },
    });
    candlestickSeries = chart.addCandlestickSeries({ upColor:'#00ff9d', downColor:'#ff0062', borderVisible:false, wickUpColor:'#00ff9d', wickDownColor:'#ff0062'});
    generateMarketData();
    setInterval(addNewCandle, 60000);
}

// --- INDICATEURS ---
function calculateRSI(data, period=14){
    if(data.length < period+1) return 50;
    let gains=0, losses=0;
    for(let i=data.length-period;i<data.length;i++){
        const change=data[i].close - data[i-1].close;
        if(change>0) gains+=change;
        else losses-=change;
    }
    const avgGain=gains/period, avgLoss=losses/period;
    if(avgLoss===0) return 100;
    const rs=avgGain/avgLoss;
    return 100-(100/(1+rs));
}

function calculateEMA(data, period){
    if(data.length<period) return null;
    const multiplier = 2/(period+1);
    let ema = data[data.length-period].close;
    for(let i=data.length-period+1;i<data.length;i++){
        ema = (data[i].close - ema)*multiplier + ema;
    }
    return ema;
}

function calculateMACD(data){
    const ema12=calculateEMA(data,12);
    const ema26=calculateEMA(data,26);
    if(!ema12||!ema26) return null;
    return ema12-ema26;
}

// --- GENERATE SIGNAL FIABLE ---
function analyzeMarket(){
    if(state.isTrading) return;
    state.isTrading=true;
    document.getElementById('analyze-btn').disabled=true;
    document.getElementById('idle-state').style.display='none';
    document.getElementById('signal-state').style.display='none';
    document.getElementById('loading-state').style.display='block';
    addLog('üîç Analyse des donn√©es TradingView en cours...', 'info');

    setTimeout(()=>{
        const rsi=calculateRSI(state.marketData);
        const macd=calculateMACD(state.marketData);
        const ema20=calculateEMA(state.marketData,20);
        const ema50=calculateEMA(state.marketData,50);
        const currentPrice=state.marketData[state.marketData.length-1].close;

        // Update indicators display
        document.getElementById('rsi-value').textContent=rsi.toFixed(1);
        const rsiEl=document.getElementById('rsi-signal');
        if(rsi>70){rsiEl.textContent='Surachet√©'; rsiEl.className='indicator-signal bearish';}
        else if(rsi<30){rsiEl.textContent='Survendu'; rsiEl.className='indicator-signal bullish';}
        else{rsiEl.textContent='Neutre'; rsiEl.className='indicator-signal neutral';}

        document.getElementById('macd-value').textContent=macd?macd.toFixed(5):'--';
        const macdEl=document.getElementById('macd-signal');
        if(macd>0){macdEl.textContent='Haussier'; macdEl.className='indicator-signal bullish';}
        else if(macd<0){macdEl.textContent='Baissier'; macdEl.className='indicator-signal bearish';}
        else{macdEl.textContent='Neutre'; macdEl.className='indicator-signal neutral';}

        const emaTrend=ema20>ema50?'Haussier':'Baissier';
        document.getElementById('ema-value').textContent=currentPrice.toFixed(5);
        const emaEl=document.getElementById('ema-signal');
        emaEl.textContent=emaTrend;
        emaEl.className=emaTrend==='Haussier'?'indicator-signal bullish':'indicator-signal bearish';

        // --- SIGNAL SCORE ---
        let score=0, direction=null;
        const last3=state.marketData.slice(-3);
        const bullishCount=last3.filter(c=>c.close>c.open).length;
        const bearishCount=last3.filter(c=>c.close<c.open).length;

        // RSI
        if(rsi<28){score+=30; direction='CALL';}
        else if(rsi>72){score+=30; direction='PUT';}

        // MACD
        if(macd>0.0005){score+= (direction==='CALL'?25:0); if(!direction) direction='CALL';}
        else if(macd<-0.0005){score+= (direction==='PUT'?25:0); if(!direction) direction='PUT';}

        // EMA
        if(emaTrend==='Haussier'){score+= (direction==='CALL'?20:0); if(!direction) direction='CALL';}
        else{score+= (direction==='PUT'?20:0); if(!direction) direction='PUT';}

        // Momentum
        if(bullishCount>=2){score+= (direction==='CALL'?15:0);}
        if(bearishCount>=2){score+= (direction==='PUT'?15:0);}

        // Contrainte perte pr√©c√©dente
        if(state.consecutiveLosses>0){score+=10;}

        // Seuil minimal
        if(score<CONFIG.minConfidence){direction=null;}

        // Affichage signal
        document.getElementById('loading-state').style.display='none';
        const signalCard=document.getElementById('signal-card');
        if(direction){
            document.getElementById('signal-state').style.display='block';
            signalCard.className=direction==='CALL'?'signal-card call':'signal-card put';
            const signalVal=document.getElementById('signal-value');
            signalVal.textContent=direction;
            signalVal.className=direction==='CALL'?'signal-value call':'signal-value put';
            document.getElementById('signal-bet').textContent=state.currentBet.toFixed(2)+'$';
            document.getElementById('signal-conf').textContent=score+'%';
            addLog(`üìä Signal <span class="log-value">${direction}</span> ‚Ä¢ RSI: ${rsi.toFixed(1)} ‚Ä¢ MACD: ${macd?macd.toFixed(5):'--'} ‚Ä¢ Score: <span class="log-value">${score}%</span> ‚Ä¢ Mise: <span class="log-value">${state.currentBet.toFixed(2)}$</span>`,'info');
            document.getElementById('win-btn').disabled=false;
            document.getElementById('loss-btn').disabled=false;
        }else{
            addLog('‚ö†Ô∏è Pas de signal fiable d√©tect√©, attente prochaine analyse.','info');
            document.getElementById('idle-state').style.display='block';
            signalCard.className='signal-card';
            document.getElementById('analyze-btn').disabled=false;
            state.isTrading=false;
        }

    },2000);
}

// --- TRADE RESULT ---
function recordTrade(isWin){
    const winBtn=document.getElementById('win-btn');
    const lossBtn=document.getElementById('loss-btn');
    const analyzeBtn=document.getElementById('analyze-btn');
    winBtn.disabled=true;
    lossBtn.disabled=true;
    const bet=state.currentBet;

    if(isWin){
        const profit=bet*CONFIG.winRate;
        state.balance+=profit;
        state.wins++;
        state.consecutiveLosses=0;
        state.currentBet=CONFIG.baseBet;
        state.martingaleLevel=0;
        addLog(`‚úÖ <span class="log-value">VICTOIRE!</span> Profit: <span class="log-value">+${profit.toFixed(2)}$</span> ‚Ä¢ Balance: <span class="log-value">${state.balance.toFixed(2)}$</span>`,'win');
    }else{
        state.balance-=bet;
        state.losses++;
        state.consecutiveLosses++;
        if(state.martingaleLevel<CONFIG.maxMartingaleLevel){
            state.martingaleLevel++;
            state.currentBet=CONFIG.baseBet*Math.pow(2,state.martingaleLevel);
            addLog(`‚ùå <span class="log-value">PERTE</span> -${bet.toFixed(2)}$ ‚Ä¢ Martingale x${state.martingaleLevel} ‚Üí Prochaine mise: <span class="log-value">${state.currentBet.toFixed(2)}$</span>`,'loss');
        }else{
            state.currentBet=CONFIG.baseBet;
            state.martingaleLevel=0;
            addLog(`‚ùå <span class="log
