<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AEGIS V19 - ALGO MATH</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root { --bg: #040508; --card: #0d1117; --buy: #00ff88; --sell: #ff3366; --primary: #2962ff; }
body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; text-align: center; }
.container { background: var(--card); border-radius: 20px; padding: 15px; border: 1px solid #30363d; }
.display-box { height: 180px; background: #000; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid #333; margin: 15px 0; }
.sig-text { font-size: 38px; font-weight: 900; }
.details { font-size: 10px; color: #8b949e; text-align: left; width: 80%; line-height: 1.5; margin-top: 10px; }
button { background: #ffffff; color: #000; border: none; padding: 18px; border-radius: 12px; width: 100%; font-weight: 900; cursor: pointer; }
button:disabled { opacity: 0.3; }
</style>
</head>
<body>

<div class="container">
    <div style="font-size: 11px; color: var(--primary); font-weight: bold;">MOTEUR MATHÃ‰MATIQUE V19</div>
    
    <div class="display-box" id="box">
        <div id="label" style="font-size: 10px; color: #888;">SCANNER ACTIF</div>
        <div id="signal" class="sig-text">---</div>
        <div id="details" class="details"></div>
    </div>

    <button id="btn" onclick="runAlgo()">DÃ‰TECTER CONFLUENCE</button>
</div>

<script>
// === TES FONCTIONS MATHÃ‰MATIQUES (NON MODIFIÃ‰ES) ===
function EMA(values, period) {
    const k = 2 / (period + 1);
    let ema = values[0];
    for (let i = 1; i < values.length; i++) { ema = values[i] * k + ema * (1 - k); }
    return ema;
}

function RSI(values, period = 14) {
    let gains = 0, losses = 0;
    for (let i = values.length - period; i < values.length - 1; i++) {
        const diff = values[i + 1] - values[i];
        if (diff > 0) gains += diff; else losses -= diff;
    }
    return 100 - (100 / (1 + (gains / (losses || 1))));
}

function MACD(values) {
    return EMA(values, 12) - EMA(values, 26);
}

// === LOGIQUE D'AFFICHAGE SYNC ===
function runAlgo() {
    const btn = document.getElementById('btn');
    const sig = document.getElementById('signal');
    const det = document.getElementById('details');
    const box = document.getElementById('box');

    btn.disabled = true;
    sig.innerText = "...";
    det.innerHTML = "";

    setTimeout(() => {
        // Simulation de prix M5 (Bougies de ton broker)
        const prices = Array.from({length: 50}, () => 1.08 + Math.random() * 0.01);
        
        const ema50 = EMA(prices, 50);
        const ema200 = EMA(prices, 200);
        const rsi = RSI(prices);
        const macd = MACD(prices);

        let res = { signal: "ATTENDRE", color: "#484f58", reason: "Filtres non alignÃ©s" };

        // TA STRATÃ‰GIE
        if (ema50 > ema200 && rsi < 35 && macd > 0) {
            res = { signal: "ACHAT ðŸŸ¢", color: "var(--buy)", reason: "CONFLUENCE HAUSSIÃˆRE" };
        } else if (ema50 < ema200 && rsi > 65 && macd < 0) {
            res = { signal: "VENTE ðŸ”´", color: "var(--sell)", reason: "CONFLUENCE BAISSIÃˆRE" };
        }

        sig.innerText = res.signal;
        sig.style.color = res.color;
        box.style.borderColor = res.color;
        det.innerHTML = `
            â€¢ EMA 50/200: ${ema50 > ema200 ? 'UP' : 'DOWN'}<br>
            â€¢ RSI (14): ${rsi.toFixed(2)}<br>
            â€¢ MACD: ${macd.toFixed(5)}<br>
            â€¢ EXPIRATION: 5 MIN
        `;

        setTimeout(() => { btn.disabled = false; }, 10000);
    }, 800);
}
</script>
</body>
</html>
