<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AEGIS V23 - AUTO SNIPER FAST</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root { --bg:#05070a; --card:#12151c; --buy:#00ff88; --sell:#ff3366; --primary:#2962ff; }
body { font-family:Inter,sans-serif; background:var(--bg); color:white; margin:0; padding:10px; text-align:center; }
.container { background:var(--card); border-radius:20px; padding:20px; border:1px solid #2a2e39; }
.status-badge { padding:5px 12px; border-radius:50px; font-size:10px; border:1px solid #333; }
.active { color:var(--buy); border-color:var(--buy); background:rgba(0,255,136,.1); }

.display-zone {
  height:220px; background:#000; border-radius:15px;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  border:4px solid #1a1f26; margin:15px 0; position:relative;
}

.price-live { position:absolute; top:10px; right:15px; font-family:monospace; font-size:12px; color:var(--primary); }
.sig-text { font-size:40px; font-weight:900; }

button { background:white; color:black; padding:18px; border-radius:12px; width:100%; font-weight:900; border:none; cursor:pointer; }
.btn-stop { background:var(--sell); color:white; margin-top:10px; font-size:12px; display:none; }
</style>
</head>

<body>
<div class="container">
  <div id="badge" class="status-badge">SYSTÃˆME EN ATTENTE</div>

  <div class="display-zone" id="box">
    <div class="price-live" id="price">EUR/USD: 1.08200</div>
    <div id="signal" class="sig-text">VEILLE</div>
    <div style="font-size:11px;color:#666">EMA 9 / EMA 21 / RSI 7</div>
  </div>

  <button id="startBtn" onclick="startBot()">ACTIVER LA SURVEILLANCE</button>
  <button id="stopBtn" class="btn-stop" onclick="stopBot()">ARRÃŠTER LE ROBOT</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();
let running = false, loop;

// ====== OUTILS ======
function EMA(values, period) {
  const k = 2 / (period + 1);
  let ema = values[0];
  for (let i = 1; i < values.length; i++) {
    ema = values[i] * k + ema * (1 - k);
  }
  return ema;
}

function RSI(values, period = 7) {
  let gains = 0, losses = 0;
  for (let i = values.length - period; i < values.length - 1; i++) {
    const diff = values[i + 1] - values[i];
    if (diff > 0) gains += diff;
    else losses -= diff;
  }
  return 100 - (100 / (1 + gains / (losses || 1)));
}

// ====== PRIX SIMULÃ‰ ======
setInterval(() => {
  const p = (1.082 + Math.random()*0.001).toFixed(5);
  document.getElementById("price").innerText = "EUR/USD: " + p;
}, 500);

// ====== BOT ======
function startBot() {
  running = true;
  document.getElementById("badge").classList.add("active");
  document.getElementById("badge").innerText = "AUTO-SNIPER ACTIF";
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("stopBtn").style.display = "block";
  loop = setInterval(scanMarket, 3000);
}

function stopBot() {
  running = false;
  clearInterval(loop);
  location.reload();
}

function scanMarket() {
  if (!running) return;

  // GÃ©nÃ©ration prix (exemple)
  const prices = Array.from({length:30}, () => 1.082 + Math.random()*0.001);

  const ema9  = EMA(prices, 9);
  const ema21 = EMA(prices, 21);
  const rsi7  = RSI(prices, 7);

  const last = prices[prices.length-1];
  const prev = prices[prices.length-2];

  // ACHAT RAPIDE
  if (ema9 > ema21 && rsi7 > 52 && rsi7 < 68 && last > prev) {
    showSignal("ACHAT ðŸŸ¢", "var(--buy)");
  }

  // VENTE RAPIDE
  else if (ema9 < ema21 && rsi7 < 48 && rsi7 > 32 && last < prev) {
    showSignal("VENTE ðŸ”´", "var(--sell)");
  }
}

function showSignal(txt, col) {
  const sig = document.getElementById("signal");
  const box = document.getElementById("box");

  sig.innerText = txt;
  sig.style.color = col;
  box.style.borderColor = col;

  try { navigator.vibrate(300); } catch(e) {}

  // Pause 1 minute aprÃ¨s signal
  clearInterval(loop);
  setTimeout(() => {
    if (running) loop = setInterval(scanMarket, 3000);
  }, 60000);
}
</script>
</body>
</html>
