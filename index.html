<script>
    let balance = 10.00;
    const apiKey = '9d0cbeba8e3343c59c7292d1d296a790';
    let currentEurUsd = 1.08542; // Prix de départ sécurisé

    // 1. GESTION DU FLUX EUR/USD (API + SIMULATION DE SECOURS)
    async function updatePrice() {
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 3000); // Timeout 3s

            const response = await fetch(`https://api.twelvedata.com/price?symbol=EUR/USD&apikey=${apiKey}`, { signal: controller.signal });
            const data = await response.json();
            
            if (data.price) {
                currentEurUsd = parseFloat(data.price);
            } else {
                // Si l'API est en pause, on crée un micro-mouvement (ex: 1.08542 -> 1.08543)
                currentEurUsd += (Math.random() * 0.0001 - 0.00005);
            }
        } catch (e) {
            // En cas d'erreur réseau, on maintient le mouvement fluide
            currentEurUsd += (Math.random() * 0.0001 - 0.00005);
        }
    }

    // Mise à jour toutes les 5 secondes pour la réactivité
    setInterval(updatePrice, 5000);

    function startHFTScan() {
        const btn = document.getElementById('hft-btn');
        const scan = document.getElementById('hft-scan');
        const res = document.getElementById('hft-result');
        const idle = document.getElementById('hft-idle');
        const sig = document.getElementById('sig-val');
        const box = document.getElementById('box');
        const logs = document.getElementById('logs');
        const expText = document.getElementById('exp-timer');

        // Initialisation
        btn.disabled = true;
        idle.style.display = 'none';
        res.style.display = 'none';
        scan.style.display = 'block';
        box.style.animation = "none";
        box.style.borderColor = "#222";

        // Animation Latence
        let ms = 0;
        const msInt = setInterval(() => {
            ms += Math.random() * 10;
            document.getElementById('ms-counter').innerText = ms.toFixed(2) + " ms";
            document.getElementById('v-val').innerText = (ms/12).toFixed(1) + " MS";
        }, 50);

        setTimeout(() => {
            clearInterval(msInt);
            
            // Logique de direction (Momentum Chaser)
            const direction = Math.random() > 0.5 ? "CALL" : "PUT";
            scan.style.display = 'none';
            res.style.display = 'block';
            sig.innerText = direction;
            
            const color = direction === "CALL" ? "#00ff88" : "#ff0044";
            sig.style.color = color;
            box.style.borderColor = color;
            box.style.animation = direction === "CALL" ? "pulse-win 1.5s infinite" : "pulse-loss 1.5s infinite";

            // Timer expiration
            let timeLeft = 60;
            const expInt = setInterval(() => {
                timeLeft--;
                expText.innerText = timeLeft + "s";
                if(timeLeft <= 0) clearInterval(expInt);
            }, 1000);

            // Calcul Profit & Progression vers 1000$
            const profit = (Math.random() * 2.1 + 0.4).toFixed(2);
            balance += parseFloat(profit);
            document.getElementById('balance').innerText = balance.toFixed(2) + "$";
            
            let progress = (balance / 1000) * 100;
            document.getElementById('progress-fill').style.width = Math.min(progress, 100) + "%";

            // Log formaté avec le prix EUR/USD réel
            const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            logs.innerHTML = `<div>> [${time}] EUR/USD @${currentEurUsd.toFixed(5)} | ${direction} <span style="color:${color}">+$${profit}</span></div>` + logs.innerHTML;

            // Cooldown rapide
            let cd = 3;
            const cooldownInt = setInterval(() => {
                btn.innerText = `NEXT SCAN (${cd}s)`;
                cd--;
                if(cd < 0) {
                    clearInterval(cooldownInt);
                    btn.disabled = false;
                    btn.innerText = "SNIPE MOMENTUM";
                }
            }, 1000);

        }, 2000);
    }
                                  </script>
