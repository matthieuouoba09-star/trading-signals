<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEGIS PRO - EUR/USD OTC Trading Robot</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Electrolize&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #141920;
            --bg-card: #1a1f28;
            --accent-cyan: #00fff9;
            --accent-purple: #bd00ff;
            --success: #00ff88;
            --danger: #ff0055;
            --warning: #ffaa00;
            --text-primary: #e6edf3;
            --text-muted: #7d8590;
            --border: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0d1117 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.1;
            z-index: 0;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            font-family: 'Electrolize', sans-serif;
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 8px;
            margin-bottom: 10px;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 20px var(--accent-cyan)); }
            50% { filter: drop-shadow(0 0 40px var(--accent-purple)); }
        }

        .subtitle {
            font-size: 12px;
            color: var(--text-muted);
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        /* Main Grid Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Card Base */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
            animation: scanline 3s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .card-title {
            font-family: 'Electrolize', sans-serif;
            font-size: 14px;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title::before {
            content: '‚ñ∏';
            color: var(--accent-purple);
        }

        /* Capital Section */
        .capital-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'Electrolize', sans-serif;
        }

        .stat-value.success { color: var(--success); }
        .stat-value.danger { color: var(--danger); }
        .stat-value.warning { color: var(--warning); }

        /* Progress Bar */
        .progress-container {
            margin-top: 16px;
            position: relative;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan));
            transition: width 0.5s ease;
            box-shadow: 0 0 20px var(--accent-cyan);
        }

        .progress-label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 8px;
            text-align: center;
        }

        /* Trading Monitor */
        .trading-monitor {
            grid-column: 1 / -1;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Candle History */
        .candle-history {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
        }

        .candle-box {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 10px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            text-transform: uppercase;
        }

        .candle-box.bullish {
            color: var(--success);
            border-color: var(--success);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .candle-box.bearish {
            color: var(--danger);
            border-color: var(--danger);
            box-shadow: 0 0 10px rgba(255, 0, 85, 0.2);
        }

        /* Signal Display */
        .signal-display {
            text-align: center;
        }

        .signal-status {
            font-size: 12px;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .signal-value {
            font-size: 120px;
            font-weight: 700;
            font-family: 'Electrolize', sans-serif;
            line-height: 1;
            margin: 20px 0;
            text-transform: uppercase;
            animation: signalPulse 2s ease-in-out infinite;
        }

        @keyframes signalPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .signal-value.call {
            color: var(--success);
            text-shadow: 0 0 40px var(--success);
        }

        .signal-value.put {
            color: var(--danger);
            text-shadow: 0 0 40px var(--danger);
        }

        .signal-value.wait {
            color: var(--text-muted);
            font-size: 60px;
        }

        .signal-info {
            display: flex;
            justify-content: center;
            gap: 32px;
            margin-top: 20px;
        }

        .signal-detail {
            text-align: center;
        }

        .signal-detail-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .signal-detail-value {
            font-size: 20px;
            font-weight: 700;
            font-family: 'Electrolize', sans-serif;
            color: var(--accent-cyan);
        }

        /* Scanning Animation */
        .scanning {
            text-align: center;
        }

        .scanning-text {
            font-size: 14px;
            color: var(--accent-cyan);
            margin-bottom: 20px;
            letter-spacing: 2px;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .scanning-timer {
            font-size: 48px;
            font-family: 'Electrolize', sans-serif;
            color: var(--text-primary);
        }

        /* Controls */
        .controls {
            grid-column: 1 / -1;
            display: flex;
            gap: 16px;
        }

        button {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-family: 'Electrolize', sans-serif;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            color: var(--bg-primary);
            box-shadow: 0 4px 20px rgba(0, 255, 249, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 30px rgba(0, 255, 249, 0.5);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--bg-secondary);
            color: var(--text-muted);
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--accent-cyan);
        }

        /* Trade Log */
        .trade-log {
            grid-column: 1 / -1;
            max-height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--border);
            font-size: 11px;
            font-family: 'Space Mono', monospace;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-entry.win {
            border-left-color: var(--success);
        }

        .log-entry.loss {
            border-left-color: var(--danger);
        }

        .log-entry.info {
            border-left-color: var(--accent-cyan);
        }

        .log-time {
            color: var(--text-muted);
            min-width: 60px;
        }

        .log-message {
            flex: 1;
        }

        .log-value {
            font-weight: 700;
            color: var(--accent-cyan);
        }

        /* Timer Countdown */
        .candle-timer {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        .timer-value {
            font-weight: 700;
            color: var(--accent-cyan);
        }

        /* Risk Management Display */
        .risk-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .risk-stat {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .risk-stat-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .risk-stat-value {
            font-size: 18px;
            font-weight: 700;
            font-family: 'Electrolize', sans-serif;
        }

        /* Custom Scrollbar */
        .trade-log::-webkit-scrollbar {
            width: 8px;
        }

        .trade-log::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .trade-log::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .trade-log::-webkit-scrollbar-thumb:hover {
            background: var(--accent-cyan);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">AEGIS PRO</h1>
            <p class="subtitle">EUR/USD OTC ‚Ä¢ TRADING ROBOT V2.0</p>
        </div>

        <div class="dashboard">
            <!-- Capital Management -->
            <div class="card">
                <h2 class="card-title">Capital Management</h2>
                <div class="capital-info">
                    <div class="stat">
                        <div class="stat-label">Balance Actuel</div>
                        <div class="stat-value success" id="balance">50.00$</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Objectif Journalier</div>
                        <div class="stat-value warning" id="target">70.00$</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Profit/Perte</div>
                        <div class="stat-value" id="profit">+0.00$</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">% Progression</div>
                        <div class="stat-value" id="progress-pct">0%</div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-label">Progression vers objectif</div>
                </div>
            </div>

            <!-- Risk Management -->
            <div class="card">
                <h2 class="card-title">Risk Management</h2>
                <div class="risk-info">
                    <div class="risk-stat">
                        <div class="risk-stat-label">Mise Actuelle</div>
                        <div class="risk-stat-value" id="current-bet">1.00$</div>
                    </div>
                    <div class="risk-stat">
                        <div class="risk-stat-label">Niveau Martingale</div>
                        <div class="risk-stat-value" id="martingale-level">0</div>
                    </div>
                    <div class="risk-stat">
                        <div class="risk-stat-label">S√©rie Actuelle</div>
                        <div class="risk-stat-value" id="streak">0</div>
                    </div>
                </div>
                <div class="capital-info" style="margin-top: 16px; margin-bottom: 0;">
                    <div class="stat">
                        <div class="stat-label">Trades Gagn√©s</div>
                        <div class="stat-value success" id="wins">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Trades Perdus</div>
                        <div class="stat-value danger" id="losses">0</div>
                    </div>
                </div>
            </div>

            <!-- Trading Monitor -->
            <div class="card trading-monitor">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="status-text">SYST√àME ACTIF</span>
                </div>

                <div class="candle-history" id="candle-history">
                    <!-- Populated by JS -->
                </div>

                <div class="candle-timer">
                    PROCHAINE BOUGIE DANS: <span class="timer-value" id="candle-timer">--</span>
                </div>

                <div id="idle-state" style="text-align: center;">
                    <div style="font-size: 60px; color: var(--text-muted); margin-bottom: 20px;">‚è∏</div>
                    <div style="font-size: 18px; color: var(--text-muted); letter-spacing: 2px;">MODE VEILLE</div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 10px;">Appuyez sur ANALYSER pour d√©marrer</div>
                </div>

                <div id="scanning-state" style="display: none;">
                    <div class="scanning">
                        <div class="scanning-text">‚ö° ANALYSE DES BOUGIES M1 EN COURS...</div>
                        <div class="scanning-timer" id="scan-timer">0.00ms</div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 12px;">Calcul RSI ‚Ä¢ Momentum ‚Ä¢ Patterns</div>
                    </div>
                </div>

                <div id="signal-state" style="display: none;">
                    <div class="signal-display">
                        <div class="signal-status" id="signal-status">‚úì SIGNAL D√âTECT√â</div>
                        <div class="signal-value" id="signal-value">CALL</div>
                        <div class="signal-info">
                            <div class="signal-detail">
                                <div class="signal-detail-label">Confiance</div>
                                <div class="signal-detail-value" id="confidence">85%</div>
                            </div>
                            <div class="signal-detail">
                                <div class="signal-detail-label">Expiration</div>
                                <div class="signal-detail-value" id="expiration">1min</div>
                            </div>
                            <div class="signal-detail">
                                <div class="signal-detail-label">Mise Sugg√©r√©e</div>
                                <div class="signal-detail-value" id="suggested-bet">1.00$</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="btn-primary" id="analyze-btn" onclick="analyzeMarket()">
                    ‚ö° ANALYSER LE MARCH√â
                </button>
                <button class="btn-secondary" id="win-btn" onclick="recordTrade(true)" disabled>
                    ‚úì GAGN√â
                </button>
                <button class="btn-secondary" id="loss-btn" onclick="recordTrade(false)" disabled>
                    ‚úó PERDU
                </button>
            </div>

            <!-- Trade Log -->
            <div class="card">
                <h2 class="card-title">Journal de Trading</h2>
                <div class="trade-log" id="trade-log">
                    <div class="log-entry info">
                        <span class="log-time">--:--:--</span>
                        <span class="log-message">Syst√®me initialis√© ‚Ä¢ Balance: <span class="log-value">50.00$</span></span>
                    </div>
                    <div class="log-entry info">
                        <span class="log-time">--:--:--</span>
                        <span class="log-message">Objectif: <span class="log-value">+20.00$</span> (40% du capital)</span>
                    </div>
                    <div class="log-entry info">
                        <span class="log-time">--:--:--</span>
                        <span class="log-message">Strat√©gie: Martingale Progressive x1.5 (Max 3 niveaux)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            startBalance: 50.00,
            targetProfit: 20.00,
            baseBet: 1.00,
            martingaleMultiplier: 1.5,
            maxMartingaleLevel: 3,
            stopLoss: 20.00,
            minConfidence: 75,
            winRate: 0.82, // 82% payout
        };

        // State
        let state = {
            balance: CONFIG.startBalance,
            currentBet: CONFIG.baseBet,
            martingaleLevel: 0,
            wins: 0,
            losses: 0,
            consecutiveLosses: 0,
            candleHistory: [],
            isTrading: false,
            lastSignal: null,
        };

        // Initialize candle timer
        function updateCandleTimer() {
            const now = new Date();
            const seconds = now.getSeconds();
            const timeLeft = 60 - seconds;
            const timerEl = document.getElementById('candle-timer');
            
            if (timeLeft <= 10) {
                timerEl.style.color = 'var(--danger)';
                timerEl.style.fontWeight = 'bold';
            } else {
                timerEl.style.color = 'var(--accent-cyan)';
                timerEl.style.fontWeight = 'normal';
            }
            
            timerEl.textContent = timeLeft + 's';
        }

        setInterval(updateCandleTimer, 1000);
        updateCandleTimer();

        // Generate candle history
        function generateCandleHistory() {
            const history = [];
            for (let i = 0; i < 5; i++) {
                history.push({
                    bullish: Math.random() > 0.5,
                    rsi: Math.floor(Math.random() * 100),
                });
            }
            return history;
        }

        // Display candle history
        function displayCandleHistory(history) {
            const container = document.getElementById('candle-history');
            container.innerHTML = '';
            
            history.slice(-3).forEach((candle, idx) => {
                const div = document.createElement('div');
                div.className = `candle-box ${candle.bullish ? 'bullish' : 'bearish'}`;
                div.textContent = `C-${3-idx}: ${candle.bullish ? '‚ñ≤' : '‚ñº'}`;
                container.appendChild(div);
            });
        }

        // Calculate signal
        function calculateSignal(history) {
            const lastCandles = history.slice(-5);
            let score = 0;
            let direction = null;

            // RSI Analysis
            const avgRSI = lastCandles.reduce((sum, c) => sum + c.rsi, 0) / lastCandles.length;
            if (avgRSI > 70) {
                score += 30;
                direction = 'PUT';
            } else if (avgRSI < 30) {
                score += 30;
                direction = 'CALL';
            }

            // Pattern Analysis: Check for consecutive candles
            const last3 = lastCandles.slice(-3);
            const allBullish = last3.every(c => c.bullish);
            const allBearish = last3.every(c => !c.bullish);

            if (allBullish) {
                score += 40;
                direction = 'PUT'; // Reversal expected
            } else if (allBearish) {
                score += 40;
                direction = 'CALL'; // Reversal expected
            }

            // Momentum check
            const recentBullish = last3.filter(c => c.bullish).length;
            if (recentBullish === 2) {
                score += 20;
            }

            // Extreme RSI boost
            const lastRSI = lastCandles[lastCandles.length - 1].rsi;
            if (lastRSI > 80 || lastRSI < 20) {
                score += 15;
            }

            return {
                direction: score >= CONFIG.minConfidence ? direction : 'WAIT',
                confidence: Math.min(95, score + Math.floor(Math.random() * 10)),
                rsi: Math.round(avgRSI),
            };
        }

        // Add log entry
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('trade-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            
            const now = new Date();
            const time = now.toLocaleTimeString('fr-FR');
            
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-message">${message}</span>
            `;
            
            logContainer.insertBefore(entry, logContainer.firstChild);
            
            // Keep only last 20 entries
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // Update UI
        function updateUI() {
            document.getElementById('balance').textContent = state.balance.toFixed(2) + '$';
            
            const profit = state.balance - CONFIG.startBalance;
            const profitEl = document.getElementById('profit');
            profitEl.textContent = (profit >= 0 ? '+' : '') + profit.toFixed(2) + '$';
            profitEl.className = profit >= 0 ? 'stat-value success' : 'stat-value danger';
            
            const progress = (profit / CONFIG.targetProfit) * 100;
            document.getElementById('progress-pct').textContent = Math.max(0, Math.round(progress)) + '%';
            document.getElementById('progress-bar').style.width = Math.max(0, Math.min(100, progress)) + '%';
            
            document.getElementById('current-bet').textContent = state.currentBet.toFixed(2) + '$';
            document.getElementById('martingale-level').textContent = state.martingaleLevel;
            document.getElementById('wins').textContent = state.wins;
            document.getElementById('losses').textContent = state.losses;
            
            const streak = state.consecutiveLosses > 0 ? `-${state.consecutiveLosses}` : `+${state.wins - state.losses}`;
            document.getElementById('streak').textContent = streak;
            
            // Check stop conditions
            if (profit >= CONFIG.targetProfit) {
                addLog(`üéØ <span class="log-value">OBJECTIF ATTEINT!</span> Profit: <span class="log-value">${profit.toFixed(2)}$</span>`, 'win');
                document.getElementById('status-text').textContent = 'OBJECTIF ATTEINT';
            } else if (profit <= -CONFIG.stopLoss) {
                addLog(`‚õî <span class="log-value">STOP-LOSS ATTEINT!</span> Perte: <span class="log-value">${profit.toFixed(2)}$</span>`, 'loss');
                document.getElementById('status-text').textContent = 'STOP-LOSS ACTIV√â';
            }
        }

        // Analyze market
        async function analyzeMarket() {
            if (state.isTrading) return;
            
            const analyzeBtn = document.getElementById('analyze-btn');
            const winBtn = document.getElementById('win-btn');
            const lossBtn = document.getElementById('loss-btn');
            
            // Check stop conditions
            const profit = state.balance - CONFIG.startBalance;
            if (profit >= CONFIG.targetProfit) {
                addLog('‚õî Objectif atteint. Arr√™t du trading recommand√©.', 'info');
                return;
            }
            if (profit <= -CONFIG.stopLoss) {
                addLog('‚õî Stop-loss atteint. Arr√™t du trading obligatoire.', 'loss');
                return;
            }
            
            state.isTrading = true;
            analyzeBtn.disabled = true;
            
            // Hide idle, show scanning
            document.getElementById('idle-state').style.display = 'none';
            document.getElementById('signal-state').style.display = 'none';
            document.getElementById('scanning-state').style.display = 'block';
            
            addLog('‚ö° Analyse du march√© EUR/USD OTC en cours...', 'info');
            
            // Simulate scanning
            let ms = 0;
            const scanInterval = setInterval(() => {
                ms += Math.random() * 15;
                document.getElementById('scan-timer').textContent = ms.toFixed(2) + 'ms';
            }, 50);
            
            // Generate and analyze
            setTimeout(() => {
                clearInterval(scanInterval);
                
                state.candleHistory = generateCandleHistory();
                displayCandleHistory(state.candleHistory);
                
                const signal = calculateSignal(state.candleHistory);
                state.lastSignal = signal;
                
                // Hide scanning, show result
                document.getElementById('scanning-state').style.display = 'none';
                document.getElementById('signal-state').style.display = 'block';
                
                const signalEl = document.getElementById('signal-value');
                const confidenceEl = document.getElementById('confidence');
                const suggestedBetEl = document.getElementById('suggested-bet');
                
                if (signal.direction === 'WAIT') {
                    signalEl.textContent = 'ATTENDRE';
                    signalEl.className = 'signal-value wait';
                    confidenceEl.textContent = signal.confidence + '%';
                    suggestedBetEl.textContent = '--';
                    addLog(`‚è∏ Signal faible (${signal.confidence}%). RSI: ${signal.rsi}. Attendre une meilleure opportunit√©.`, 'info');
                    
                    // Re-enable analyze button after delay
                    setTimeout(() => {
                        analyzeBtn.disabled = false;
                        state.isTrading = false;
                    }, 3000);
                } else {
                    signalEl.textContent = signal.direction;
                    signalEl.className = `signal-value ${signal.direction.toLowerCase()}`;
                    confidenceEl.textContent = signal.confidence + '%';
                    document.getElementById('expiration').textContent = '1min';
                    suggestedBetEl.textContent = state.currentBet.toFixed(2) + '$';
                    
                    addLog(`üìä Signal <span class="log-value">${signal.direction}</span> d√©tect√© ‚Ä¢ Confiance: <span class="log-value">${signal.confidence}%</span> ‚Ä¢ RSI: ${signal.rsi} ‚Ä¢ Mise: <span class="log-value">${state.currentBet.toFixed(2)}$</span>`, 'info');
                    
                    // Enable win/loss buttons
                    winBtn.disabled = false;
                    lossBtn.disabled = false;
                }
            }, 2800);
        }

        // Record trade result
        function recordTrade(isWin) {
            const winBtn = document.getElementById('win-btn');
            const lossBtn = document.getElementById('loss-btn');
            const analyzeBtn = document.getElementById('analyze-btn');
            
            winBtn.disabled = true;
            lossBtn.disabled = true;
            
            const betAmount = state.currentBet;
            
            if (isWin) {
                const profit = betAmount * CONFIG.winRate;
                state.balance += profit;
                state.wins++;
                state.consecutiveLosses = 0;
                state.currentBet = CONFIG.baseBet;
                state.martingaleLevel = 0;
                
                addLog(`‚úÖ <span class="log-value">TRADE GAGN√â!</span> Profit: <span class="log-value">+${profit.toFixed(2)}$</span> ‚Ä¢ Nouveau solde: <span class="log-value">${state.balance.toFixed(2)}$</span>`, 'win');
            } else {
                state.balance -= betAmount;
                state.losses++;
                state.consecutiveLosses++;
                
                // Apply Martingale
                if (state.martingaleLevel < CONFIG.maxMartingaleLevel) {
                    state.martingaleLevel++;
                    state.currentBet = CONFIG.baseBet * Math.pow(CONFIG.martingaleMultiplier, state.martingaleLevel);
                    addLog(`‚ùå <span class="log-value">TRADE PERDU!</span> Perte: <span class="log-value">-${betAmount.toFixed(2)}$</span> ‚Ä¢ Martingale niveau ${state.martingaleLevel} ‚Ä¢ Prochaine mise: <span class="log-value">${state.currentBet.toFixed(2)}$</span>`, 'loss');
                } else {
                    // Reset after max Martingale
                    state.currentBet = CONFIG.baseBet;
                    state.martingaleLevel = 0;
                    addLog(`‚ùå <span class="log-value">TRADE PERDU!</span> Perte: <span class="log-value">-${betAmount.toFixed(2)}$</span> ‚Ä¢ Max Martingale atteint, reset √† mise de base.`, 'loss');
                }
            }
            
            updateUI();
            
            // Return to idle after delay
            setTimeout(() => {
                document.getElementById('signal-state').style.display = 'none';
                document.getElementById('idle-state').style.display = 'block';
                analyzeBtn.disabled = false;
                state.isTrading = false;
            }, 2000);
        }

        // Initialize
        updateUI();
        addLog('‚úì Syst√®me pr√™t √† trader', 'info');
    </script>
</body>
    </html>
