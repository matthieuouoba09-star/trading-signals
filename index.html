<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AEGIS V23 - AUTO SNIPER CONSEIL</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root { --bg:#05070a; --card:#12151c; --buy:#00ff88; --sell:#ff3366; --primary:#2962ff; }
body { font-family:Inter,sans-serif; background:var(--bg); color:white; margin:0; padding:10px; text-align:center; }
.container { background:var(--card); border-radius:20px; padding:20px; border:1px solid #2a2e39; }
.status-badge { padding:5px 12px; border-radius:50px; font-size:10px; border:1px solid #333; }
.active { color:var(--buy); border-color:var(--buy); background:rgba(0,255,136,.1); }
.display-zone { height:220px; background:#000; border-radius:15px; display:flex; flex-direction:column; justify-content:center; align-items:center; border:4px solid #1a1f26; margin:15px 0; position:relative; }
.price-live { position:absolute; top:10px; right:15px; font-family:monospace; font-size:12px; color:var(--primary); }
.sig-text { font-size:40px; font-weight:900; }
.advice-card { margin-top:10px; background:#1a1f26; border-radius:10px; padding:10px; border-left:4px solid var(--primary); display:none; text-align:center; }
button { background:white; color:black; padding:18px; border-radius:12px; width:100%; font-weight:900; border:none; cursor:pointer; }
.btn-stop { background:var(--sell); color:white; margin-top:10px; font-size:12px; display:none; }
</style>
</head>
<body>

<div class="container">
  <div id="badge" class="status-badge">SYSTÃˆME EN ATTENTE</div>

  <div class="display-zone" id="box">
    <div class="price-live" id="price">EUR/USD: 1.08200</div>
    <div id="signal" class="sig-text">VEILLE</div>
    <div style="font-size:11px;color:#666">EMA 5 / EMA 5 / RSI 5</div>
  </div>

  <div id="advice" class="advice-card">
    <div id="trade-advice" style="font-weight:bold;font-size:16px;"></div>
  </div>

  <button id="startBtn" onclick="startBot()">ACTIVER LA SURVEILLANCE</button>
  <button id="stopBtn" class="btn-stop" onclick="stopBot()">ARRÃŠTER LE ROBOT</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();
let running=false, loop;

// ====== INDICATEURS ======
function EMA(values, period) {
  const k = 2/(period+1);
  let ema = values[0];
  for(let i=1;i<values.length;i++){
    ema = values[i]*k + ema*(1-k);
  }
  return ema;
}

function RSI(values, period=5){
  let gains=0, losses=0;
  for(let i=values.length-period;i<values.length-1;i++){
    const diff = values[i+1]-values[i];
    if(diff>0) gains+=diff; else losses-=diff;
  }
  return 100-(100/(1+(gains/(losses||1))));
}

// ====== PRIX SIMULÃ‰ ======
setInterval(()=>{
  const p=(1.082 + Math.random()*0.001).toFixed(5);
  document.getElementById("price").innerText = "EUR/USD: "+p;
},500);

// ====== BOT ======
function startBot(){
  running=true;
  document.getElementById("badge").classList.add("active");
  document.getElementById("badge").innerText="AUTO-SNIPER ACTIF";
  document.getElementById("startBtn").style.display="none";
  document.getElementById("stopBtn").style.display="block";
  loop = setInterval(scanMarket,3000);
}

function stopBot(){
  running=false;
  clearInterval(loop);
  location.reload();
}

function scanMarket(){
  if(!running) return;
  const prices = Array.from({length:20},()=>1.082 + Math.random()*0.001);
  const emaFast = EMA(prices,5);
  const emaSlow = EMA(prices,5);
  const rsiVal = RSI(prices,5);
  const last = prices[prices.length-1];
  const prev = prices[prices.length-2];

  let signal="VEILLE", color="#888", adviceText="";

  if(emaFast>emaSlow && rsiVal>55 && last>prev){
    signal="ACHAT ðŸŸ¢";
    color="var(--buy)";
    adviceText = (rsiVal>65) ? "1 MINUTE (FLASH)" : "5 MINUTES (SÃ›R)";
  } else if(emaFast<emaSlow && rsiVal<45 && last<prev){
    signal="VENTE ðŸ”´";
    color="var(--sell)";
    adviceText = (rsiVal<35) ? "1 MINUTE (FLASH)" : "5 MINUTES (SÃ›R)";
  } else {
    adviceText="ATTENDRE";
  }

  showSignal(signal,color,adviceText);
}

function showSignal(txt,col,adviceText){
  const sig=document.getElementById("signal");
  const box=document.getElementById("box");
  const advice=document.getElementById("advice");
  const trade=document.getElementById("trade-advice");

  sig.innerText=txt;
  sig.style.color=col;
  box.style.borderColor=col;

  trade.innerText=adviceText;
  advice.style.display="block";

  try{navigator.vibrate(300);}catch(e){}

  // Pause selon le conseil
  clearInterval(loop);
  let pause = (adviceText.includes("1 MINUTE")) ? 60000 : (adviceText.includes("5 MINUTES")) ? 300000 : 0;
  setTimeout(()=>{ if(running) loop=setInterval(scanMarket,3000); }, pause);
}
</script>

</body>
</html>
