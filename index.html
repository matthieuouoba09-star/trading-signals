<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REAL MARKET - Robot Trading</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<style>
/* === TON CSS ORIGINAL — INCHANGÉ POUR GARDER LA FORME === */
:root {
--bg:#0a0a0f;--surface:#12121a;--surface-light:#1a1a26;
--primary:#00d4ff;--success:#00ff9d;--danger:#ff0062;
--warning:#ffb800;--text:#e8e8f0;--text-dim:#6b6b80;
--border:#2a2a3a;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);padding:20px;}
.container{max-width:1400px;margin:0 auto;}
/* (reste du CSS identique — non répété ici pour compacité visuelle) */
</style>
</head>

<body>
<div class="container">
<h2>REAL MARKET — Robot Trading</h2>
<div id="chart" style="height:400px"></div>
<button onclick="analyzeMarket()">ANALYSER</button>
</div>

<script>
/* ============================
CONFIG — sécurisée
============================ */

const CONFIG = {
startBalance: 50,
baseBet: 1,
martingaleMultiplier: 2,   // ↓ plus safe
maxMartingaleLevel: 3,     // ↓ limite risque
payout: 0.82
};

let state = {
balance: CONFIG.startBalance,
currentBet: CONFIG.baseBet,
martingaleLevel: 0,
wins: 0,
losses: 0,
consecutiveLosses: 0,
marketData: []
};

/* ============================
CHART
============================ */

let chart = LightweightCharts.createChart(document.getElementById('chart'), {
layout:{background:{color:"#0a0a0f"},textColor:"#6b6b80"},
grid:{vertLines:{color:"#1a1a26"},horzLines:{color:"#1a1a26"}}
});

let series = chart.addCandlestickSeries({
upColor:"#00ff9d",
downColor:"#ff0062",
borderVisible:false
});

/* ============================
DATA SIMULATION (toujours fake — clair net précis)
============================ */

function generateData(){
let p=1.08;
let now=Math.floor(Date.now()/1000);
for(let i=120;i>=0;i--){
let o=p;
let c=o+(Math.random()-0.5)*0.002;
let h=Math.max(o,c)+Math.random()*0.0006;
let l=Math.min(o,c)-Math.random()*0.0006;

state.marketData.push({
time:now-i*60,
open:+o.toFixed(5),
high:+h.toFixed(5),
low:+l.toFixed(5),
close:+c.toFixed(5)
});
p=c;
}
series.setData(state.marketData);
}
generateData();

/* ============================
INDICATEURS PRO
============================ */

function ema(values,period){
const k=2/(period+1);
let e=values[0];
for(let i=1;i<values.length;i++){
e=values[i]*k+e*(1-k);
}
return e;
}

function rsiWilder(data,period=14){
if(data.length<period+1) return 50;

let gains=0,losses=0;

for(let i=data.length-period;i<data.length;i++){
let d=data[i].close-data[i-1].close;
if(d>0) gains+=d; else losses-=d;
}

let avgGain=gains/period;
let avgLoss=losses/period;

for(let i=data.length-period+1;i<data.length;i++){
let d=data[i].close-data[i-1].close;
avgGain=(avgGain*(period-1)+(d>0?d:0))/period;
avgLoss=(avgLoss*(period-1)+(d<0?-d:0))/period;
}

if(avgLoss===0) return 100;
let rs=avgGain/avgLoss;
return 100-100/(1+rs);
}

function macdFull(data){
if(data.length<35) return null;
let closes=data.map(x=>x.close);
let ema12=ema(closes.slice(-26),12);
let ema26=ema(closes.slice(-26),26);
let macd=ema12-ema26;

let macdSeries=[];
for(let i=0;i<9;i++) macdSeries.push(macd);
let signal=ema(macdSeries,9);

return {macd,signal,hist:macd-signal};
}

/* ============================
ANALYSE SIGNAL
============================ */

function analyzeMarket(){

let rsi=rsiWilder(state.marketData);
let macd=macdFull(state.marketData);

let closes=state.marketData.map(x=>x.close);
let ema20=ema(closes.slice(-40),20);
let ema50=ema(closes.slice(-80),50);

let scoreCall=0;
let scorePut=0;

/* RSI */
if(rsi<30) scoreCall+=2;
if(rsi>70) scorePut+=2;

/* MACD */
if(macd){
if(macd.hist>0) scoreCall+=2;
if(macd.hist<0) scorePut+=2;
}

/* TREND */
if(ema20>ema50) scoreCall+=1;
else scorePut+=1;

/* MOMENTUM 3 bougies */
let last3=state.marketData.slice(-3);
let bull=last3.filter(c=>c.close>c.open).length;
if(bull>=2) scoreCall+=1;
if(bull<=1) scorePut+=1;

/* NO TRADE ZONE */
if(rsi>45 && rsi<55){
console.log("Zone neutre — pas de trade");
return;
}

let direction = scoreCall>scorePut ? "CALL" : "PUT";
let confidence = Math.min(95,60+Math.abs(scoreCall-scorePut)*10);

console.log("Signal:",direction,"Conf:",confidence,"%","RSI:",rsi.toFixed(1));
}

/* ============================
TIMEFRAME FIX
============================ */

function changeTimeframe(tf,el){
document.querySelectorAll(".timeframe-btn")
.forEach(b=>b.classList.remove("active"));
el.classList.add("active");
}

</script>
</body>
</html>
