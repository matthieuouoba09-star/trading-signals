<script>
    let balance = 10.00;
    const apiKey = '9d0cbeba8e3343c59c7292d1d296a790';
    let currentEurUsd = 1.08540; 

    // 1. Fonction pour récupérer le prix réel ou simuler si l'API échoue
    async function fetchForexPrice() {
        try {
            const response = await fetch(`https://api.twelvedata.com/price?symbol=EUR/USD&apikey=${apiKey}`);
            const data = await response.json();
            if (data.price) {
                currentEurUsd = parseFloat(data.price).toFixed(5);
            } else {
                // Si l'API limite (trop de requêtes), on simule un petit mouvement
                currentEurUsd = (parseFloat(currentEurUsd) + (Math.random() * 0.0001 - 0.00005)).toFixed(5);
            }
        } catch (e) {
            // Simulation de secours en cas d'erreur réseau
            currentEurUsd = (parseFloat(currentEurUsd) + (Math.random() * 0.0001 - 0.00005)).toFixed(5);
        }
    }

    // Mise à jour fréquente pour l'animation
    setInterval(fetchForexPrice, 5000);

    function startHFTScan() {
        const btn = document.getElementById('hft-btn');
        const scan = document.getElementById('hft-scan');
        const res = document.getElementById('hft-result');
        const idle = document.getElementById('hft-idle');
        const sig = document.getElementById('sig-val');
        const box = document.getElementById('box');
        const logs = document.getElementById('logs');
        const expText = document.getElementById('exp-timer');

        // Réinitialisation visuelle
        btn.disabled = true;
        idle.style.display = 'none';
        res.style.display = 'none';
        scan.style.display = 'block';
        box.style.animation = "none";
        box.style.borderColor = "#222";

        // Animation des millisecondes
        let ms = 0;
        const msInt = setInterval(() => {
            ms += Math.random() * 12;
            document.getElementById('ms-counter').innerText = ms.toFixed(2) + " ms";
            document.getElementById('v-val').innerText = (ms/15).toFixed(1) + " MS";
        }, 40);

        setTimeout(() => {
            clearInterval(msInt);
            
            // Logique de direction
            const direction = Math.random() > 0.5 ? "CALL" : "PUT";
            scan.style.display = 'none';
            res.style.display = 'block';
            sig.innerText = direction;
            
            // Couleurs et Pulsation
            const color = direction === "CALL" ? "#00ff88" : "#ff0044";
            sig.style.color = color;
            box.style.borderColor = color;
            box.style.animation = direction === "CALL" ? "pulse-win 1.5s infinite" : "pulse-loss 1.5s infinite";

            // Timer Expiration 60s
            let timeLeft = 60;
            const expInt = setInterval(() => {
                timeLeft--;
                expText.innerText = timeLeft + "s";
                if(timeLeft <= 0) clearInterval(expInt);
            }, 1000);

            // Mise à jour Solde et Barre
            const profit = (Math.random() * 1.8 + 0.2).toFixed(2);
            balance += parseFloat(profit);
            document.getElementById('balance').innerText = balance.toFixed(2) + "$";
            
            let progress = (balance / 1000) * 100;
            document.getElementById('progress-fill').style.width = Math.min(progress, 100) + "%";

            // Ajout au Log
            const time = new Date().toLocaleTimeString('fr-FR', { hour12: false });
            logs.innerHTML = `<div>> [${time}] EUR/USD @${currentEurUsd} | ${direction} <span style="color:${color}">+${profit}$</span></div>` + logs.innerHTML;

            // Cooldown
            let cd = 3;
            const cooldownInt = setInterval(() => {
                btn.innerText = `ANALYSE... (${cd}s)`;
                cd--;
                if(cd < 0) {
                    clearInterval(cooldownInt);
                    btn.disabled = false;
                    btn.innerText = "SNIPE MOMENTUM";
                }
            }, 1000);

        }, 2000); // Scan plus rapide pour plus de nervosité
    }
                </script>
