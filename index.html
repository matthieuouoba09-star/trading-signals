<script>
const tg = window.Telegram.WebApp;
tg.expand();

function detectNow() {
    const box = document.getElementById('main-box');
    const val = document.getElementById('signal-val');
    const label = document.getElementById('signal-label');
    const msg = document.getElementById('timer-msg');

    label.innerText = "ANALYSE MULTI-FILTRES";
    val.innerText = "...";
    box.style.borderColor = "#333";

    setTimeout(() => {

        /* =========================
           DONNÃ‰ES (simulation rÃ©aliste)
           Ã€ remplacer plus tard par API Python
        ========================= */

        const ema50 = 1.0852;
        const ema200 = 1.0839;
        const rsi14 = 74; // exemple rÃ©el

        /* =========================
           LOGIQUE STRATÃ‰GIQUE
        ========================= */

        let signal = "ATTENDRE";
        let color = "#888";
        let reason = "Pas de confluence";

        const trendUp = ema50 > ema200;
        const trendDown = ema50 < ema200;

        if (trendUp && rsi14 < 30) {
            signal = "ACHAT ðŸŸ¢";
            color = "var(--buy)";
            reason = "Tendance haussiÃ¨re + RSI bas";
        }

        if (trendDown && rsi14 > 70) {
            signal = "VENTE ðŸ”´";
            color = "var(--sell)";
            reason = "Tendance baissiÃ¨re + RSI haut";
        }

        /* =========================
           AFFICHAGE
        ========================= */

        val.innerText = signal;
        val.style.color = color;
        box.style.borderColor = color;

        label.innerText = signal === "ATTENDRE"
            ? "MARCHÃ‰ NON ALIGNÃ‰"
            : "CONFLUENCE CONFIRMÃ‰E";

        msg.innerText = "EXPIRATION : 5 MINUTES";

    }, 600);
}
</script>
